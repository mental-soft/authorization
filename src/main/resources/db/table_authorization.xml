<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

   <changeSet id="1" author="okan.demirtas">
        <comment>Rollerin tutulduğu tablo.
        </comment>
        <createTable tableName="ROLE">
            <column name="ID" type="serial" incrementBy="2" startWith="5" >
                <constraints primaryKey="true" primaryKeyName="PK_ID"/>
            </column>
            <column name="KEY" type="VARCHAR(100)"/>
            <column name="NAME" type="VARCHAR(250)"/>
        </createTable>
       <alterSequence incrementBy="1"
                      startValue="100"
                      sequenceName="role_id_seq"/>
    </changeSet>

    <changeSet id="2" author="okan.demirtas">
        <comment>Kullanıcıların rollerinin belirtildiği tablo.
            Role tablosundan role_id fk olarak alır.
            User tablosunda user_id fk sanal olarak alır.
        </comment>
        <createTable tableName="USER_ROLE">
            <column name="USER_ID" type="NUMBER"/>
            <column name="ROLE_ID" type="Int">
                <constraints foreignKeyName="FK_USERROLE_ROLE"
                             referencedTableName="ROLE"
                             referencedColumnNames="ID"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="3" author="okan.demirtas" context="test-data">
        <comment>Test verisi eklendi</comment>
        <insert tableName="ROLE">
            <column name="KEY" value="test_Add_Key_1"/>
            <column name="NAME" value="veri ekleme rolü 1"/>
        </insert>
        <insert tableName="USER_ROLE">
            <column name="USER_ID" valueNumeric="1"/>
            <column name="ROLE_ID" valueComputed="( select currval('role_id_seq') )" />
        </insert>
        <insert tableName="ROLE">
            <column name="KEY" value="test_Add_Key2"/>
            <column name="NAME" value="veri ekleme rolü 2."/>
        </insert>
        <insert tableName="USER_ROLE">
            <column name="USER_ID" valueNumeric="1"/>
            <column name="ROLE_ID" valueComputed="( select currval('role_id_seq') )" />
        </insert>
        <insert tableName="ROLE">
            <column name="KEY" value="test_Update_Key_1"/>
            <column name="NAME" value="veri güncelleme rolü 1."/>
        </insert>
        <insert tableName="USER_ROLE">
            <column name="USER_ID" valueNumeric="2"/>
            <column name="ROLE_ID" valueComputed="( select currval('role_id_seq') )" />
        </insert>
        <insert tableName="ROLE">
            <column name="KEY" value="test_Update_Key_2"/>
            <column name="NAME" value="veri güncelleme rolü 2."/>
        </insert>
        <insert tableName="USER_ROLE">
            <column name="USER_ID" valueNumeric="2"/>
            <column name="ROLE_ID" valueComputed="( select currval('role_id_seq') )" />
        </insert>
    </changeSet>

</databaseChangeLog>